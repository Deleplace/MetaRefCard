#!/usr/bin/env python3

from collections import OrderedDict
import sys
import re

sys.path.append("3rdparty/edrefcard")
from bindingsData import *


outFilename = 'config/generatedDevices.yaml'

outFile = open(outFilename, "w")
outFile.write('''#################################################################
### GENERATED BY generateControllerInputs.py - DO NOT MODIFY. ###
#################################################################
---
''')

deviceNameMap = OrderedDict()
imageMap = {}
for groupName in supportedDevices:
    for shortName in supportedDevices[groupName]['HandledDevices']:
        imageMap[shortName] = supportedDevices[groupName]['Template']


# TODO - Need to handle "KeyDevice" in grouping
outFile.write('DeviceMap:\n')
completedDevices = {}
for name in supportedDevices:
    for device in supportedDevices[name]['HandledDevices']:
        if device == 'Keyboard':
            continue
        if device in completedDevices:
            continue
        completedDevices[device] = True
        outFile.write('  {d}:\n'.format(d=device))

        for key in hotasDetails[device]:
            if key == 'displayName':
                continue
            shortKey = re.sub('^Joy_', '', key)
            data = hotasDetails[device][key]
            height = 54
            if 'height' in data:
                height = data['height']
            outFile.write('    {k}: {{ x: {x}, y: {y}, w: {w}, h: {h} }}\n'
                          .format(k=shortKey, x=data['x'], y=data['y'],
                                  w=data['width'], h=height))

outFile.write('ImageMap:\n')
for groupName in imageMap:
    outFile.write('  {g} : {i}\n'.format(g=groupName, i=imageMap[groupName]))
outFile.write('''...''')

outFile.close()
